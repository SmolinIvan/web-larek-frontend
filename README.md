# Проектная работа "Веб-ларек" (сдача документации)

(К сожалению, я запутался в описании задания и чек-листе к проектной работе 8-ого спринта, и начал реализовывать функционал, пока не дошел до валидации форм, и понял, что задание слишком объемное. Я перечитал задание и начал писать документацию в READ.me Прошу считать эту итерацию как попытку сдать документацию, если это возможно, спасибо)
Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект "Веб-ларёк" реализует пример типового интернет-магазина. Пользователь может ознакомиться с каталогом товаров, добавлять и убирать товары из корзины, произвести оплату продуктов, лежащих в корзине. Проект реализован на TypeScript с использованием MVP-паттерна. Для получения данных используется API

## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:

1. Просмотр каталога товаров на странице (Page) и выбор продукта (ProductPreview). Здесь можно добавить в корзину товар, или убрать его от туда
2. Просмотр корзины (BasketView). Из корзины товары можно только удалить или перейти к оплате товаров
3. Оформление заказа (PayOptionsView, UserDataView, SuccessView)

Просмотр товаров, корзины и оформление заказа происходит внутри модального окна: содержимое форм, корзины и карточек отображается внутри одного и того же модального окна

## Структура проекта

.
├── src/
│ ├── common.blocks/ [Стили компонент верстки]
│ ├── components/ [Реализация]
│ │ ├── base/ [Базовый код]
│ │ ├── model/ [Модели данных]
│ │ ├── view/ [Отображения]
│ ├── pages/
│ │ ├── index.html [Основная страница и шаблоны компонент]
│ ├── types/ [Типизация]
│ │ ├── index.ts [Модели данных и отображения]
│ ├── utils/
│ │ ├── constants.ts [Константы для проекта]
│ │ ├── utils.ts [Утилиты для работы с DOM]
├── api.yaml [Спецификация API]

## Архитектура проекта (MVP)

Реализовано 3 модели данных: CatalogModel, BasketModel, и OrderModel (`src/components/model/СatalogModel.ts`, `src/components/model/BasketModel.ts`, `src/components/model/OrderModel.ts`). После получения ответа от сервера, данные о продуктах хранятся в CatalogModel, при выборе определенных продуктов соответствущие данные добавляются в BasketModel (или удаляются от туда соответствующим методом). После выбора продуктов на этапе оформления заказа данные о продуктах из корзины добавляются в OrderModel, туда же добавляются данные о плательщике. После оплаты CatalogModel очищается. Все изменения данных происходят через методы соответствующих моделей, а они в свою очередь уведомляют об изменениях через метод настроек `on(items: changed)` и `on(basket: changed)`.

Экземпляры моделей, экземпляр модального окна, экземпляр основной страницы и классы отвечающие за отображение элементов на странице передаются в Презентер (`src/components/model/Presenter.ts`). Презентер обрабатывает действия пользователя, отображает актуальное состояние страницы в зависимости от моделей и обновляет состояния моделей через их методы
которые по факту являются обработчиками пользовательских действий и обновляют состояние модели через ее методы.

Пример взаимодействия:

1. С сервера приходят данные и сохраняются в CatalogModel
2. При сохранении данных в модель вызывается событие отрисовки карточек товаров
3. При клике на карточку срабатывает событие открывающее модальное окно, в модальное окно отрисовываются данные выбранного товара (ProductPreview)
4. При добавлении товара в корзину данные о товаре добавлю.тся в BasketModel, содержимое корзины отрисовывается (BasketPreview)
5. При клике на "Оформить" вызывается событие открывающее модальное окно с содержимым формы для выбора способа оплаты (PaymentView)
6. При заполнении формы в OrderModel сохраняется выбранные данных, которые хранились в BasketModel и данные веденные с формы. Срабатывает событие вызывающее открытие модального окна с способом оплаты (ContactsView)
7. При сохранении данных с этой формы в OrderModel добавляются данные введенный в форме и отправляется запрос на сервер с данными хранящимися в OrderModel. BasketModel очищается, BasketView очищается, OrderModel очищается, отображается модального окно об успешной операции (SuccessView)

## Базовый код

### Отображения

#### Класс PageView отвечает за отрисовку карточек на странице

У класса есть следующие методы:

1. setProductCounter - устанавливает значение счетчика количества товаров в корзине
2. setBasketButtonHandler - устанавливает слушатель события на кнопку корзины
3. render - отрисовка страницы

Поле products отвечает за установку содержимого на странице, а поле locked - за блокировку страницы
PageView наследуется от базового класса Component и реализует интерфейс ICatalogView

---

#### Класс ProductView - отображает карточку каталога. В карточке есть картинка, цена, название товара и категория

У класса есть свойства:

1. data - хранит данные о товаре (карточке)
2. itemTitle,categoryBlock, imageBlock, priceBlock - элементы карточки, в свойства которых передаются определенные данные
   Методы:
3. setOpenModalHandler - метод, чтобы навесить необходимый слушатель события на карточку
4. render - отрисовка карточки

Класс реализует интерфейс IProductView

---

#### Класс ProductPreview - отображает более подробную информацию о товаре. Инфо о карточке отображается внутри модального окна ModalView

Свойства класса

- preview: HTMLElement - основной элемент карточки товара
- buyButton: HTMLButtonElement - кнопка для покупки
- handleBuyProduct: Function - обработчик события покупки
- descriptionElement: HTMLSpanElement - элемент для описания
- titleElement: HTMLHeadingElement - элемент заголовка
- priceElement: HTMLSpanElement - элемент цены
- categoryElement: HTMLSpanElement - элемент категории
- imageElement: HTMLImageElement - элемент изображения
- \_data: IProduct - данные о товаре

Конструктор (Инициализирует все элементы интерфейса):

- Клонирует шаблон карточки
- Находит все необходимые элементы по селекторам
- Добавляет обработчик клика на кнопку покупки

Геттеры/сеттеры:

- data - для получения и установки данных о товаре
- categoryColor - для установки цвета категории
- buttonText - для установки текста на кнопке

Методы:

- setHandler - устанавливает обработчик покупки
- setDisabled - включает/отключает элемент
- render - отрисовывает карточку товара с данными

Особенности реализации:

- Защита данных: Использование приватного поля \_data и публичного геттера/сеттера data
- Валидация цены: Проверка типа цены и блокировка кнопки при некорректном типе
- Динамическая загрузка: Автоматическое добавление классов и установка URL изображения
- Управление состоянием: Возможность включения/отключения элементов интерфейса

---

#### Класс BasketView представляет собой компонент корзины покупок, который отвечает за визуализацию и взаимодействие с пользовательским интерфейсом корзины.

Свойства

- basketElement: HTMLElement - корневой элемент корзины
- priceElement: HTMLElement - элемент для отображения общей цены
- handleMakeOrder: Function - обработчик оформления заказа
- \_content: HTMLElement - контейнер для элементов корзины
- makeOrderButton: HTMLButtonElement - кнопка оформления заказа

Конструктор инициализирует компонент корзины на основе переданного шаблона.

Сеттеры:

- content - позволяет установить содержимое корзины, заменяя текущие элементы на новые
- price - устанавливает текущую стоимость корзины в формате “цена синапсов”
  Методы:
- setDisabled - включает или отключает указанный элемент интерфейса
- setHandler - устанавливает обработчик для кнопки оформления заказа
- render - возвращает готовый к рендерингу корневой элемент корзины
  Класс реализует интерфейс IBasketView и предоставляет полный функционал для работы с корзиной покупок: от отображения содержимого до оформления заказа. Все защищенные свойства предназначены для внутреннего использования и обеспечивают корректную работу интерфейса корзины.

---

#### Класс BasketItemView представляет собой компонент для отображения отдельного товара в корзине покупок.

Свойства

- itemElement - корневой элемент карточки товара
- \_data - данные о товаре в корзине
- itemTitle - элемент для отображения названия товара
- priceBlock - элемент для отображения цены товара
- handleDeleteItem - обработчик удаления товара
- button - кнопка удаления товара
- index - элемент для отображения порядкового номера товара

Геттеры/Сеттеры

- data - получает/устанавливает данные о товаре
- title - устанавливает название товара
- indexNumber - устанавливает порядковый номер товара

Методы

- setDeleteHandler - устанавливает обработчик для удаления товара
- render - визуализирует карточку товара

Особенности

- Класс реализует интерфейс IBasketItemView
- Использует шаблонный подход для инициализации элементов интерфейса
- Автоматически привязывает обработчик удаления товара
- Поддерживает динамическое обновление данных о товаре

---

#### Класс ModalView представляет собой компонент для отображения модального окна. Наследует функциональность от базового класса Component.

Свойства

- \_content - элемент для отображения содержимого модального окна
- container (protected) - корневой элемент модального окна
- events (protected) - система событий для взаимодействия

Сеттеры

- content - устанавливает содержимое модального окна

Методы

- open() - открывает модальное окно
- close() - закрывает модальное окно
- clickOverlayModalHandle(event: MouseEvent) - обработчик клика по оверлею

Особенности

- Автоматически обрабатывает закрытие модального окна по клику на крестик
- Поддерживает систему событий для уведомления об открытии/закрытии
- Позволяет динамически менять содержимое окна
- Имеет обработчик клика по оверлею для закрытия модального окна

Примечания

- Все protected свойства предназначены для внутреннего использования
- Класс использует делегирование событий для обработки клика на крестик
- При закрытии модального окна содержимое очищается

---

#### Класс PaymentView представляет собой компонент формы для выбора способа оплаты и адреса доставки. Наследует функциональность от базового класса Form.

Свойства

- orderElement (protected) - корневой элемент формы заказа
- onlineButton - кнопка выбора оплаты картой
- offlineButton - кнопка выбора оплаты наличными
- addressInput - поле ввода адреса
- handleOnlineMethod (protected) - обработчик выбора оплаты картой
- handleOfflineMethod (protected) - обработчик выбора оплаты наличными
- handleSubmitAddress (protected) - обработчик отправки адреса

Методы

- setCardOptionHandler - устанавливает обработчик выбора оплаты картой
- setCashOptionHandler - устанавливает обработчик выбора оплаты наличными
- uncheckPaymentMethod - снимает отметку с выбранного способа оплаты

Особенности

- Поддерживает два способа оплаты (картой и наличными)
- Имеет поле для ввода адреса доставки
- Позволяет устанавливать обработчики для различных действий пользователя

---

#### Класс ContactsView представляет собой компонент формы для ввода контактных данных пользователя (email и телефон). Наследует функциональность от базового класса Form.

Свойства

- contactsElement (protected) - корневой элемент формы контактов
- emailInput - поле ввода email
- phoneInput - поле ввода телефона

Методы

- orderError() - отображает сообщение об ошибке при некорректном заполнении полей заказа

Особенности

- Содержит два обязательных поля для ввода контактных данных
- Имеет встроенный механизм отображения ошибок валидации
- Использует шаблонный подход для инициализации элементов интерфейса

Примечания

- Все protected свойства предназначены для внутреннего использования
- Класс автоматически находит элементы формы по заданным селекторам
- Сообщение об ошибке отображается в элементе с классом form\_\_errors

---

#### Класс SuccessView представляет собой компонент для отображения успешной операции с указанием списанной суммы в синапсах.

Свойства

- successElement (protected) - корневой элемент интерфейса успеха
- totalPriceElement (protected) - элемент для отображения суммы
- \_totalPrice (protected) - общая сумма операции
- successButton (protected) - кнопка действия после успешной операции
- handleSuccess (protected) - обработчик нажатия кнопки

Сеттеры/Геттеры

- set totalPrice - устанавливает сумму операции
- get totalPrice - получает сумму операции

Методы

- setHandleSuccess - устанавливает обработчик для кнопки
- render - отображает интерфейс успеха

Особенности

- Использует шаблонный подход для инициализации элементов интерфейса
- Автоматически отображает сумму в элементе интерфейса
- Поддерживает установку обработчика для кнопки действия
- Форматирует отображаемую сумму в виде “Списано X синапсов”

---

### Модели

В классе три модели, которые хранят в себе данные и оперируют ими:

1. `CatalogModel` хранит в себе информацию о товарах, которые пришли с сервера
2. `BasketModel` хранит в себе информацию о добавленные товарах. В модель можно добавлять товары из `CatalogModel` и удалять, после отправки заказа данные очищаются
3. `OrderModel` - сюда добавляются товары из `BasketModel` на последнем этапе оформления заказа, и добавляются данные на этапе оформления заказа, после подтверждения заказа данные очищаются

##### Класс CatalogModel представляет собой модель каталога товаров, реализующую интерфейс ICatalogModel. Предназначен для управления коллекцией товаров и предоставления методов для работы с ними.

Свойства

- \_items: IProduct[] - массив товаров
- events: IEvents - система событий

Методы

- getItems() - возвращает массив всех товаров
- getItem(id: string) - возвращает товар по указанному ID
- getTotal() - возвращает общее количество товаров
- set_Items(\_items: IProduct[]) - устанавливает новый массив товаров и вызывает событие items:changed

Особенности

- Использует систему событий для уведомления об изменении списка товаров
- Предоставляет методы для получения как всей коллекции, так и отдельного товара
- Автоматически подсчитывает общее количество товаров
- Поддерживает обновление списка товаров с уведомлением подписчиков

##### Класс BasketModel представляет собой модель корзины покупок, реализующую интерфейс IBasketModel. Предназначен для управления содержимым корзины и отслеживания общей стоимости товаров.

Свойства

- items: - карта товаров в корзине
- totalPrice - общая стоимость товаров
- events - система событий
  Методы
- add - добавляет товар в корзину
- remove - удаляет товар из корзины
- getItems - возвращает массив товаров в корзине
- clear- очищает корзину
  Особенности
- Использует Map для хранения товаров с уникальными ID
- Автоматически обновляет общую стоимость при изменении корзины
- Выпускает событие basket:changed при любом изменении корзины
- Предоставляет методы для добавления, удаления и очистки корзины

##### Класс OrderModel представляет собой модель заказа, которая хранит данные о способах оплаты, контактных данных пользователя, общей стоимости и содержимом заказа.

Свойства

- _orderData - объект с данными заказа
- events - система событий

Сеттеры

- payment - способ оплаты
- email- email пользователя
- phone- телефон пользователя
- address- адрес доставки
- items - список товаров
- total - общая сумма заказа

Геттер

- orderData - возвращает все данные заказа

Методы

- clear() - очищает данные заказа и выпускает событие order:changed

Особенности

- Использует систему событий для уведомления об изменении данных заказа
- Предоставляет сеттеры для установки всех параметров заказа
- Позволяет получить все данные заказа через геттер
- Поддерживает полное очищение данных заказа

---

### Презентер (Presenter)

Класс `Presenter` связь между интерфейсом и моделями данных:

1.  При взаимодействии пользователя с интерфейсом, презентер реагирует на это и передает необходимые данные в модели (получение данных с сервера, передача данных с форм, передача данных из модели в модель)
2.  При определенных событиях связанных с данными в моделя, презентер реагирует на это и вызывает изменения в интерфейсе (отрисовку элементов)

Свойства

- cardTemplate - шаблон карточки с товаром
- cardProduct - товар (продукт)
- previewProduct - экземпляр класса
- basketView - экземпляр класса
- basketButton -кнопка "Корзина"
- basketCounter - счетчик товаров над корзиной
- productPreviewTemplate - шаблон элемента отображения подробной информации продукта
- basketTemplate: HTMLTemplateEleme -шаблон элемента корзины
- basketItemView - экземпляр класса
- basketItemTemplate -шаблон элемента товара в козине
- paymentTemplate - шаблон формы выбора оплаты
- paymentView - экземпляр класса
- contactsTemplate -шаблон формы для ввода данных пользователя
- contactsView - экземпляр класса
- successTemplate - шаблон окна об успехе операции
- successView - экземпляр класса

Конструктор принимает конструкторы классов и экземпляр класса модального окна

- catalogModel: CatalogModel,
- basketModel: BasketModel,
- orderModel: OrderModel,
- viewProductConstructor: IProductConstructor,
- viewPageContainer: ICatalogView,
- basketConstructor: BasketViewConstructor,
- productPreviewConstructor: ProductPreviewConstructor,
- modal: IModal,
- basketItemConstructor: BasketItemConstructor,
- paymentViewConstructor: PaymentViewConstructor,
- contactsViewConstructor: ContactsViewConstructor,
- successViewConstructor: SuccessViewConstructor

Методы

- handleBuyProduct - слушатель события, срабатывающий при добавлении товара в корзину. При клике на кнопку Добавить в корзине, товар добавляется в BasketModel, при клике на Убрать из корзины - удаляется
- handleOpenPreviewModal - слушатель события, открытие модального окна
- handleDeleteProduct - слушатель события, удаление товара из BasketModel
- handleOpenBasketView - // слушатель события, передача данных из basketModel в интерфейс, открывается окно, которое видит пользователь, содержащее товары, хранящиеся в basketModel, и итоговую стоимость
- handleOpenPayment - слушатель события, отображается окно с выбором оплаты, на кнопки и поля ввода навешиваются слушатели
- handleMakeOnlineOption - слушатель на кнопку Онлайн в форме выбора оплата
- handleMakeCashOption - слушатель на кнопку Картой в форме выбора оплата
- handleSubmitOrder - слушатель на отправку данных с формы, данные с формы передаются в OrderModel, отображается форма с данными пользователи и на новую форму навешивается слушатель
- handleSubmitContacts - слушатель на отправку данных с формы, данные с формы и список товаров из (BasketModel) передаются в OrderModel, отображается форма с данными пользователи, данные моделей очищаются
- renderCatalogView - отрисовка продуктов на странице
- renderBasketView - отрисовка товаров в корзине

___
### Абстрактный класс Form<T> представляет собой базовый класс для работы с формами, обеспечивающий функциональность обработки форм и их элементов.

Свойства
- form: HTMLFormElement - элемент формы
- handleSubmit: Function - обработчик отправки формы
- submitButton: HTMLButtonElement - кнопка отправки формы

Конструктор
- constructor(formTemplate: HTMLTemplateElement) - инициализирует форму из шаблона

Методы
- setSubmitHandler(handleSubmit: Function) - устанавливает обработчик отправки формы
- getInputData(input: HTMLInputElement) - получает значение указанного инпута
- clearInputs() - очищает все инпуты формы
- render(): HTMLFormElement - возвращает готовый элемент формы

Особенности
- Использует шаблонный подход для инициализации формы
- Предотвращает стандартное поведение отправки формы
- Позволяет динамически получать значения полей формы
- Поддерживает очистку всех полей формы
- Обеспечивает базовую функциональность для работы с формами

___

### Класс OrderAPI представляет собой реализацию API для работы с заказами, наследуя функциональность от базового класса Api.

Наследование и интерфейсы
- Наследует класс Api
- Реализует интерфейс IOrderApi

Конструктор
- baseUrl: string - базовый URL для API
- options: RequestInit - опции запроса (опционально)

Методы
- getProducts() - получает список продуктов, возвращает: Promise<ApiListResponse<IProduct>>
- postOrder(data: OrderType) - отправляет заказ

Параметры:
- data: OrderType - данные заказа. Возвращает: Promise с результатом отправки

Особенности
- Использует базовый класс Api для обработки HTTP-запросов
- Предоставляет методы для получения продуктов и отправки заказов
- Использует типизацию через интерфейсы IProduct и OrderType
- Возвращает промисы для асинхронной работы с данными
